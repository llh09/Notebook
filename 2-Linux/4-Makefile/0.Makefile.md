# Makefile

Makefile 规则格式：

Target ... : Dependency file set...

​	comment 1

​	comment 2

​	...

要更新 Target，就必须先更新它的依赖文件；如果依赖文件中有一个更新，那么目标也必须要更新

更新：执行一遍规则中的命令

<font color=red>**NOTE：每条命令必须要以 TAB 开头！**</font>



Make 的执行过程：

1. 在当前目录下查找 Makefile 文件
2. 按照 Makefile 中定义的规则生成目标文件
3. 当目标不存在或者目标依赖文件比目标文件新的时候，就执行后面的命令来更新目标



## 1.  Makefile 变量

<font color=red>**Makefile 中的所有变量都是字符串！**</font>

```makefile
objects = main.o a.o b.o c.o

main : $(objects)
	gcc -o main $(objects)
```

Makefile 中引用变量的方法：$(变量名)

### 1.1 赋值

Makefile 中有三个赋值符号：`=`，`:=`，`?=`，`+=`

|      | 作用                                                         |
| :--: | ------------------------------------------------------------ |
|  =   | 变量的真实值取决于它所引用的变量的最后一次有效值             |
|  :=  | 只能使用前面已经定义好的                                     |
|  ?=  | 如果变量前面没有被赋值，那么此变量就是后面赋的值，如果前面已经赋过值了，那么就使用前面赋的值 |
|  +=  | 给前面已经定义好的变量添加一些字符串                         |

### 1.2 Makefile 自动化变量

如何通过一行命令来从不同的依赖文件中生成对应的目标-<font color=red>**自动化变量**</font>

| 自动化变量 | 描述                                                         |
| ---------- | ------------------------------------------------------------ |
| `$@`       | 规则中的目标集合，在模式规则中，如果有多个目标的话，`$@`表示匹配模式中定义的目标集合 |
| `$%`       | 当目标是函数库的时候表示规则中的目标成员名，如果目标不是函数库文件，那么其值为空。 |
| `$<`       | 依赖文件集合中的第一个文件，如果依赖文件是以模式(即`%`)定义的，那么`$<`就是符合模式的一系列的文件集合 |
| `$?`       | 所有比目标新的依赖目标集合，以空格分开                       |
| `$^`       | 所有依赖文件的集合，使用空格分开，如果在依赖文件中有多个重复的文件，`$^`会去除重复的依赖文件，只保留一份 |
| `$+`       | 和`$^`类似，但是当依赖文件存在重复的话不会去除重复的依赖文件 |
| `$*`       | 这个变量表示目标模式中`%`及其之前的部分                      |







